generator client {
  provider = "prisma-client-js"
  seed     = "npx tsx prisma/seed.ts"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Processo {
  id                   Int                 @id @default(autoincrement())
  numero               String              @unique
  dataCriacao          DateTime
  requerente           String?
  formaEntradaId       Int
  responsavelId        Int
  requeridoId          Int?
  situacaoId           Int
  encaminhamentoId     Int?
  pedidoManifestacaoId Int?
  contatoPrevioId      Int?
  evidenciaId          Int?
  anonimo              Boolean             @default(false)
  observacoes          String?
  temaRequerimento     String?             // Novo campo opcional
  envioPedido          DateTime?           // Novo campo opcional
  prazo                Int?                // Novo campo opcional
  dataVencimento       DateTime?           // Novo campo opcional, calculado
  processoStatusId     Int?                // Relacionado à nova tabela ProcessoStatus
  tipoReclamacaoId     Int?                // Relacionado à nova tabela TipoReclamacao
  statusInternoId      Int?                // Relacionado à nova tabela StatusInterno
  active               Boolean             @default(true) // Soft delete
  exclusionDate        DateTime?           // Soft delete timestamp

  contatoPrevio        ContatoPrevio?      @relation(fields: [contatoPrevioId], references: [id])
  encaminhamento       Encaminhamento?     @relation(fields: [encaminhamentoId], references: [id])
  evidencia            Evidencia?          @relation(fields: [evidenciaId], references: [id])
  formaEntrada         FormaEntrada        @relation(fields: [formaEntradaId], references: [id])
  pedidoManifestacao   PedidoManifestacao? @relation(fields: [pedidoManifestacaoId], references: [id])
  requerido            Requerido?          @relation(fields: [requeridoId], references: [id])
  responsavel          Responsavel         @relation(fields: [responsavelId], references: [id])
  situacao             Situacao            @relation(fields: [situacaoId], references: [id])
  processoStatus       ProcessoStatus?     @relation(fields: [processoStatusId], references: [id])
  tipoReclamacao       TipoReclamacao?     @relation(fields: [tipoReclamacaoId], references: [id])
  statusInterno        StatusInterno?      @relation(fields: [statusInternoId], references: [id])

  @@map("Processo")
}

model ProcessoStatus {
  id    Int    @id @default(autoincrement())
  nome  String @unique
  processos Processo[]
  active               Boolean             @default(true) // Soft delete
  exclusionDate        DateTime?           // Soft delete timestamp

  @@map("ProcessoStatus")
}

model TipoReclamacao {
  id    Int    @id @default(autoincrement())
  nome  String @unique
  processos Processo[]
  active               Boolean             @default(true) // Soft delete
  exclusionDate        DateTime?           // Soft delete timestamp

  @@map("TipoReclamacao")
}

model StatusInterno {
  id    Int    @id @default(autoincrement())
  nome  String @unique
  active               Boolean             @default(true) // Soft delete
  exclusionDate        DateTime?           // Soft delete timestamp
  processos Processo[]

  @@map("StatusInterno")
}

model Requerido {
  id        Int        @id @default(autoincrement())
  nome      String
  cnpj      String?    @unique
  site      String?
  email     String?
  setorId   Int?
  cnaeId    Int?
  processos Processo[]
  cnae      CNAE?      @relation(fields: [cnaeId], references: [id])
  setor     Setor?     @relation(fields: [setorId], references: [id])
  active               Boolean             @default(true) // Soft delete
  exclusionDate        DateTime?           // Soft delete timestamp

  @@map("Requerido")
}

model CNAE {
  id         Int         @id @default(autoincrement())
  active     Boolean     @default(true)
  code       String      @unique @db.VarChar(10)
  nome       String      @db.VarChar(255)
  requeridos Requerido[]
  exclusionDate        DateTime?           // Soft delete timestamp

  @@map("CNAE")
}

model FormaEntrada {
  id        Int        @id @default(autoincrement())
  nome      String     @unique
  processos Processo[]
  active               Boolean             @default(true) // Soft delete
  exclusionDate        DateTime?           // Soft delete timestamp

  @@map("FormaEntrada")
}

model Setor {
  id         Int         @id @default(autoincrement())
  nome       String      @unique
  requeridos Requerido[]
  active               Boolean             @default(true) // Soft delete
  exclusionDate        DateTime?           // Soft delete timestamp

  @@map("Setor")
}

model Situacao {
  id        Int        @id @default(autoincrement())
  nome      String     @unique
  processos Processo[]
  active               Boolean             @default(true) // Soft delete
  exclusionDate        DateTime?           // Soft delete timestamp

  @@map("Situacao")
}

model Encaminhamento {
  id        Int        @id @default(autoincrement())
  nome      String     @unique
  active               Boolean             @default(true) // Soft delete
  exclusionDate        DateTime?           // Soft delete timestamp
  processos Processo[]

  @@map("Encaminhamento")
}

model PedidoManifestacao {
  id        Int        @id @default(autoincrement())
  nome      String     @unique
  processos Processo[]
  active               Boolean             @default(true) // Soft delete
  exclusionDate        DateTime?           // Soft delete timestamp

  @@map("PedidoManifestacao")
}

model ContatoPrevio {
  id        Int        @id @default(autoincrement())
  nome      String     @unique
  active               Boolean             @default(true) // Soft delete
  exclusionDate        DateTime?           // Soft delete timestamp
  processos Processo[]

  @@map("ContatoPrevio")
}

model Evidencia {
  id        Int        @id @default(autoincrement())
  nome      String     @unique
  active               Boolean             @default(true) // Soft delete
  exclusionDate        DateTime?           // Soft delete timestamp
  processos Processo[]

  @@map("Evidencia")
}

model Perfil {
  id         Int         @id @default(autoincrement())
  nome       String      @unique
  permissoes Permissao[]
  usuarios   User[]
  active               Boolean             @default(true) // Soft delete
  exclusionDate        DateTime?           // Soft delete timestamp

  @@map("Perfil")
}

model Permissao {
  id        Int     @id @default(autoincrement())
  acao      String
  recurso   String
  permitido Boolean
  perfilId  Int
  perfil    Perfil  @relation(fields: [perfilId], references: [id])
  active               Boolean             @default(true) // Soft delete
  exclusionDate        DateTime?           // Soft delete timestamp

  @@unique([perfilId, acao, recurso])
}

model Responsavel {
  id             Int       @id @default(autoincrement())
  nome           String    @unique
  userId         String?   @unique
  user           User?     @relation("UserResponsavel", fields: [userId], references: [id])
  processos      Processo[]

  active         Boolean   @default(true)
  exclusionDate  DateTime?

  @@map("Responsavel")
}

model User {
  id             String       @id @default(uuid())
  email          String       @unique
  perfilId       Int?
  nome           String?

  responsavel    Responsavel? @relation("UserResponsavel")

  perfil         Perfil?      @relation(fields: [perfilId], references: [id])

  active         Boolean      @default(true)
  exclusionDate  DateTime?

  @@map("User")
}

